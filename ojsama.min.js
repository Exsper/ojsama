var osu={};if(typeof exports!=="undefined"){osu=exports}(function(){osu.VERSION_MAJOR=1;osu.VERSION_MINOR=0;osu.VERSION_PATCH=4;var t={warn:Function.prototype};if(typeof exports!=="undefined"){t=console}var i=function(t,i){var s=new Array(t.length);for(var e=0;e<s.length;++e){s[e]=t[e].toFixed(i)}return s};function s(t){this.time=t.time||0;this.ms_per_beat=t.ms_per_beat;if(this.ms_per_beat===undefined){this.ms_per_beat=600}this.change=t.change;if(this.change===undefined){this.change=true}}s.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"ms_per_beat: "+this.ms_per_beat.toFixed(2)+" }"};var e={circle:1<<0,slider:1<<1,spinner:1<<3};function r(t){this.pos=t.pos||[0,0]}r.prototype.toString=function(){return"pos: ["+i(this.pos,2)+"]"};function n(t){this.pos=t.pos||[0,0];this.distance=t.distance||0;this.repetitions=t.repetitions||1}n.prototype.toString=function(){return"pos: "+i(this.pos,2)+", "+"distance: "+this.distance.toFixed(2)+", "+"repetitions: "+this.repetitions};function a(t){this.time=t.time||0;this.type=t.type||0;this.data=t.data||null}a.prototype.typestr=function(){var t="";if(this.type&e.circle)t+="circle | ";if(this.type&e.slider)t+="slider | ";if(this.type&e.spinner)t+="spinner | ";return t.substring(0,Math.max(0,t.length-3))};a.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"type: "+this.typestr()+(this.data?", "+this.data.toString():"")+" }"};var o={std:0};function h(){this.reset()}h.prototype.reset=function(){this.format_version=1;this.mode=o.std;this.title=this.title_unicode="";this.artist=this.artist_unicode="";this.creator="";this.version="";this.cs=this.ar=this.od=this.hp=5;this.sv=this.tick_rate=1;this.ncircles=this.nsliders=this.nspinners=0;if(!this.objects){this.objects=[]}else{this.objects.length=0}if(!this.timing_points){this.timing_points=[]}else{this.timing_points.length=0}return this};h.prototype.max_combo=function(){var t=this.ncircles+this.nspinners;var i=-1;var s=Number.NEGATIVE_INFINITY;var r=0;for(var n=0;n<this.objects.length;++n){var a=this.objects[n];if(!(a.type&e.slider)){continue}while(a.time>=s){++i;if(this.timing_points.length>i+1){s=this.timing_points[i+1].time}else{s=Number.POSITIVE_INFINITY}var o=this.timing_points[i];var h=1;if(!o.change&&o.ms_per_beat<0){h=-100/o.ms_per_beat}if(this.format_version<8){r=this.sv*100}else{r=this.sv*100*h}}var p=a.data;var c=p.distance*p.repetitions/r;var l=Math.ceil((c-.1)/p.repetitions*this.tick_rate);--l;l*=p.repetitions;l+=p.repetitions+1;t+=Math.max(0,l)}return t};h.prototype.toString=function(){var t=this.artist+" - "+this.title+" [";if(this.title_unicode||this.artist_unicode){t+="("+this.artist_unicode+" - "+this.title_unicode+")"}t+=this.version+"] mapped by "+this.creator+"\n"+"\n"+"AR"+parseFloat(this.ar.toFixed(2))+" "+"OD"+parseFloat(this.od.toFixed(2))+" "+"CS"+parseFloat(this.cs.toFixed(2))+" "+"HP"+parseFloat(this.hp.toFixed(2))+"\n"+this.ncircles+" circles, "+this.nsliders+" sliders, "+this.nspinners+" spinners"+"\n"+this.max_combo()+" max combo"+"\n";return t};var p="osu file format v";function c(){this.map=new h;this.reset()}c.prototype.reset=function(){this.map.reset();this.nline=0;this.curline="";this.lastpos="";this.section="";return this};c.prototype.feed_line=function(t){this.curline=this.lastpos=t;++this.nline;if(this.nline==1){this.map.reset();if(!t){throw new SyntaxError("empty file")}var i=t.indexOf(p);if(i<0){throw new SyntaxError("not a valid .osu file")}this.map.format_version=parseInt(t.substring(i+p.length));return this}if(t.startsWith(" ")||t.startsWith("_")){return this}t=this.curline=t.trim();if(t.length<=0){return this}if(t.startsWith("//")){return this}if(t.startsWith("[")){this.section=t.substring(1,t.length-1);return this}if(!t){return this}switch(this.section){case"Metadata":this._metadata();break;case"General":this._general();break;case"Difficulty":this._difficulty();break;case"TimingPoints":this._timing_points();break;case"HitObjects":this._objects();break}return this};c.prototype.feed=function(t){var i=i=t.split("\n");for(var s=0;s<i.length;++s){this.feed_line(i[s])}return this};c.prototype.toString=function(){return"at line "+this.nline+"\n"+this.curline+"\n"+"-> "+this.lastpos+" <-"};c.prototype._setpos=function(t){this.lastpos=t.trim();return this.lastpos};c.prototype._warn=function(){t.warn.apply(null,Array.prototype.slice.call(arguments));t.warn(this.toString())};c.prototype._property=function(){var t=this.curline.split(":",2);t[0]=this._setpos(t[0]);t[1]=this._setpos(t[1]);return t};c.prototype._metadata=function(){var t=this._property();switch(t[0]){case"Title":this.map.title=t[1];break;case"TitleUnicode":this.map.title_unicode=t[1];break;case"Artist":this.map.artist=t[1];break;case"ArtistUnicode":this.map.artist_unicode=t[1];break;case"Creator":this.map.creator=t[1];break;case"Version":this.map.version=t[1];break}};c.prototype._general=function(){var t=this._property();if(t[0]!=="Mode"){return}this.map.mode=parseInt(this._setpos(t[1]))};c.prototype._difficulty=function(){var t=this._property();switch(t[0]){case"CircleSize":this.map.cs=parseFloat(this._setpos(t[1]));break;case"OverallDifficulty":this.map.od=parseFloat(this._setpos(t[1]));break;case"ApproachRate":this.map.ar=parseFloat(this._setpos(t[1]));break;case"HPDrainRate":this.map.hp=parseFloat(this._setpos(t[1]));break;case"SliderMultiplier":this.map.sv=parseFloat(this._setpos(t[1]));break;case"SliderTickRate":this.map.tick_rate=parseFloat(this._setpos(t[1]));break}};c.prototype._timing_points=function(){var t=this.curline.split(",");if(t.length>8){this._warn("timing point with trailing values")}var i=new s({time:parseFloat(this._setpos(t[0])),ms_per_beat:parseFloat(this._setpos(t[1]))});if(t.length>=7){i.change=t[6].trim()!=="0"}this.map.timing_points.push(i)};c.prototype._objects=function(){var t=this.curline.split(",");if(t.length>11){this._warn("object with trailing values")}var i=new a({time:parseFloat(this._setpos(t[2])),type:parseInt(this._setpos(t[3]))});if((i.type&e.circle)!=0){++this.map.ncircles;i.data=new r({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))]})}else if((i.type&osu.objtypes.spinner)!=0){++this.map.nspinners}else if((i.type&osu.objtypes.slider)!=0){++this.map.nsliders;i.data=new n({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))],repetitions:parseInt(this._setpos(t[6])),distance:parseFloat(this._setpos(t[7]))})}this.map.objects.push(i)};var l={nomod:0,nf:1<<0,ez:1<<1,hd:1<<3,hr:1<<4,dt:1<<6,ht:1<<8,nc:1<<9,fl:1<<10,so:1<<12};l.from_string=function(t){var i=0;t=t.toLowerCase();for(var s in l){if(s.length!=2){continue}if(!l.hasOwnProperty(s)){continue}if(t.indexOf(s)>=0){i|=l[s]}}return i};l.string=function(t){var i="";for(var s in l){if(s.length!=2){continue}if(!l.hasOwnProperty(s)){continue}if(t&l[s]){i+=s.toUpperCase()}}return i};l.speed_changing=l.dt|l.ht|l.nc;l.map_changing=l.hr|l.ez|l.speed_changing;var u=79.5;var m=19.5;var d=1800;var f=1200;var _=450;var v=(u-m)/10;var g=(d-f)/5;var y=(f-_)/5;function b(t,i,s){var e=t;e*=s;var r=e<5?d-g*e:f-y*(e-5);r=Math.min(d,Math.max(_,r));r/=i;e=r>f?(d-r)/g:5+(f-r)/y;return e}function w(t,i,s){var e=t;e*=s;var r=u-Math.ceil(v*e);r=Math.min(u,Math.max(m,r));r/=i;e=(u-r)/v;return e}function M(t){this.ar=t.ar;this.od=t.od;this.hp=t.hp;this.cs=t.cs;this.speed_mul=1;this._mods_cache={}}M.prototype.with_mods=function(t){if(this._mods_cache[t]){return this._mods_cache[t]}var i=this._mods_cache[t]=new M(this);if(!(t&l.map_changing)){return i}if(t&(l.dt|l.nc))i.speed_mul=1.5;if(t&l.ht)i.speed_mul*=.75;var s=1;if(t&l.hr)s=1.4;if(t&l.ez)s*=.5;if(i.ar){i.ar=b(i.ar,i.speed_mul,s)}if(i.od){i.od=w(i.od,i.speed_mul,s)}if(i.cs){if(t&l.hr)i.cs*=1.3;if(t&l.ez)i.cs*=.5;i.cs=Math.min(10,i.cs)}if(i.hp){i.hp*=s;i.hp=Math.min(10,i.hp)}return i};function j(t){this.obj=t;this.reset()}j.prototype.reset=function(){this.strains=[0,0];this.normpos=[0,0];this.is_single=false;return this};j.prototype.toString=function(){return"{ strains: ["+i(this.strains,2)+"], normpos: ["+i(this.normpos,2)+"], is_single: "+this.is_single+" }"};function x(t,i){return[t[0]-i[0],t[1]-i[1]]}function F(t,i){return[t[0]*i[0],t[1]*i[1]]}function k(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}var S=0;var I=1;var E=90;var T=110;var N=125;var O=[.3,.15];var A=[1400,26.25];var R=.9;var z=400;var P=30;var q=.0675;var C=[512,384];var V=F(C,[.5,.5]);var D=.5;function H(){this.objects=[];this.reset();this.map=null;this.mods=l.nomod;this.singletap_threshold=125}H.prototype.reset=function(){this.total=0;this.aim=0;this.speed=0;this.nsingles=0;this.nsingles_threshold=0};H.prototype.calc=function(t){var i=this.map=t.map||this.map;if(!i){throw new TypeError("no map given")}var s=this.mods=t.mods||this.mods;var r=this.singletap_threshold=t.singletap_threshold||r;var n=new M({cs:i.cs}).with_mods(s);var a=n.speed_mul;this._init_objects(this.objects,i,n.cs);this.speed=this._calc_individual(S,this.objects,a);this.aim=this._calc_individual(I,this.objects,a);this.speed=Math.sqrt(this.speed)*q;this.aim=Math.sqrt(this.aim)*q;this.total=this.aim+this.speed+Math.abs(this.speed-this.aim)*D;this.nsingles=0;this.nsingles_threshold=0;for(var o=1;o<this.objects.length;++o){var h=this.objects[o].obj;var p=this.objects[o-1].obj;if(this.objects[o].is_single){++this.nsingles}if(!(h.type&(e.circle|e.slider))){continue}var c=(h.time-p.time)/a;if(c>=r){++this.nsingles_threshold}}return this};H.prototype.toString=function(){return this.total.toFixed(2)+" stars ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed)"};H.prototype._spacing_weight=function(t,i){switch(t){case I:return Math.pow(i,.99);case S:if(i>N){return 2.5}else if(i>T){return 1.6+.9*(i-T)/(N-T)}else if(i>E){return 1.2+.4*(i-E)/(T-E)}else if(i>E/2){return.95+.25*(i-E/2)/(E/2)}return.95}throw{name:"NotImplementedError",message:"this difficulty type does not exist"}};H.prototype._calc_strain=function(t,i,s,r){var n=i.obj;var a=s.obj;var o=0;var h=(n.time-a.time)/r;var p=Math.pow(O[t],h/1e3);if((n.type&(e.slider|e.circle))!=0){var c=k(x(i.normpos,s.normpos));if(t==S){i.is_single=c>N}o=this._spacing_weight(t,c);o*=A[t]}o/=Math.max(h,50);i.strains[t]=s.strains[t]*p+o};H.prototype._calc_individual=function(t,i,s){var e=[];var r=z*s;var n=r;var a=0;var o;for(o=0;o<i.length;++o){if(o>0){this._calc_strain(t,i[o],i[o-1],s)}while(i[o].obj.time>n){e.push(a);if(o>0){var h=Math.pow(O[t],(n-i[o-1].obj.time)/1e3);a=i[o-1].strains[t]*h}else{a=0}n+=r}a=Math.max(a,i[o].strains[t])}var p=1;var c=0;e.sort(function(t,i){return i-t});for(o=0;o<e.length;++o){c+=e[o]*p;p*=R}return c};H.prototype._normalizer_vector=function(t){var i=C[0]/16*(1-.7*(t-5)/5);var s=52/i;if(i<P){s*=1+Math.min(P-i,5)/50}return[s,s]};H.prototype._init_objects=function(i,s,r){if(i.length!=s.objects.length){i.length=s.objects.length}var n=this._normalizer_vector(r);var a=F(V,n);for(var o=0;o<i.length;++o){if(!i[o]){i[o]=new j(s.objects[o])}else{i[o].reset()}var h=i[o].obj;if(h.type&e.spinner){i[o].normpos=a.slice();continue}var p;if(h.type&(e.slider|e.circle)){p=h.data.pos}else{t.warn("unknown object type ",h.type.toString(16));p=[0,0]}i[o].normpos=F(p,n)}};function W(){this.calculators=[];this.map=null}W.prototype.calc=function(t){var i=null;var s=this.map=t.map||this.map;if(!s){throw new TypeError("no map given")}if(!this.calculators[s.mode]){switch(s.mode){case o.std:i=new H;break;default:throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}this.calculators[s.mode]=i}else{i=this.calculators[s.mode]}return i.calc(t)};function U(t){this.nmiss=t.nmiss||0;if(t.n300===undefined){this.n300=-1}else{this.n300=t.n300}this.n100=t.n100||0;this.n50=t.n50||0;if(t.percent){var i=t.nobjects;if(i===undefined){throw new TypeError("nobjects is required when specifying percent")}this.nmiss=Math.min(i,this.nmiss);var s=i-this.nmiss;var e=new U({n300:s,n100:0,n50:0,nmiss:this.nmiss}).value()*100;var r=t.percent;r=Math.max(0,Math.min(e,r));this.n100=Math.round(-3*((r*.01-1)*i+this.nmiss)*.5);if(this.n100>s){this.n100=0;this.n50=Math.round(-6*((r*.01-1)*i+this.nmiss)*.5);this.n50=Math.min(s,this.n50)}this.n300=i-this.n100-this.n50-this.nmiss}}U.prototype.value=function(t){var i=this.n300;if(i<0){if(!t){throw new TypeError("either n300 or nobjects must be specified")}i=t-this.n100-this.n50-this.nmiss}else{t=i+this.n100+this.n50+this.nmiss}var s=(i*300+this.n100*100+this.n50*50)/(t*300);return Math.max(0,Math.min(s,1))};U.prototype.toString=function(){return(this.value()*100).toFixed(2)+"% "+this.n100+"x100 "+this.n50+"x50 "+this.nmiss+"xmiss"};function G(){this.aim=0;this.speed=0;this.acc=0;this.computed_accuracy=null}G.prototype.calc=function(t){var i=t.stars;var s=t.map;var e,r,n,a,o,h;var p;var c,u;if(i){s=i.map}if(s){e=s.max_combo();r=s.nsliders;n=s.ncircles;a=s.objects.length;o=s.ar;h=s.od;if(!i){i=(new H).calc(t)}}else{e=t.max_combo;if(!e||e<0){throw new TypeError("max_combo must be > 0")}r=t.nsliders;n=t.ncircles;a=t.nobjects;if(!r||!n||!a){throw new TypeError("nsliders, ncircles, nobjects are required")}if(a<r+n){throw new TypeError("nobjects must be >= nsliders + ncircles")}o=t.base_ar;if(o===undefined)o=5;h=t.base_od;if(h===undefined)h=5}if(i){p=i.mods;c=i.aim;u=i.speed}else{p=t.mods||l.nomod;c=t.aim_stars;u=t.speed_stars}if(c===undefined||u===undefined){throw new TypeError("aim and speed stars required")}var m=t.nmiss||0;var d=t.n50||0;var f=t.n100||0;var _=t.n300;if(_===undefined)_=a-f-d-m;var v=t.combo;if(v===undefined)v=e-m;var g=t.score_version||1;var y=a/2e3;var b=.95+.4*Math.min(1,y);if(a>2e3){b+=Math.log10(y)*.5}var w=Math.pow(.97,m);var j=Math.pow(v,.8)/Math.pow(e,.8);var x=new M({ar:o,od:h}).with_mods(p);this.computed_accuracy=new U({percent:t.acc_percent,nobjects:a,n300:_,n100:f,n50:d,nmiss:m});_=this.computed_accuracy.n300;f=this.computed_accuracy.n100;d=this.computed_accuracy.n50;var F=this.computed_accuracy.value();var k=1;if(x.ar>10.33){k+=.45*(x.ar-10.33)}else if(x.ar<8){var S=.01*(8-x.ar);if(p&l.hd){S*=2}k+=S}var I=this._base(c);I*=b;I*=w;I*=j;I*=k;if(p&l.hd)I*=1.18;if(p&l.fl)I*=1.45*b;var E=.5+F/2;var T=.98+x.od*x.od/2500;I*=E;I*=T;this.aim=I;var N=this._base(u);N*=b;N*=w;N*=j;N*=E;N*=T;this.speed=N;var O=F;switch(g){case 1:var A=a-r-n;O=new U({n300:Math.max(0,_-r-A),n100:f,n50:d,nmiss:m}).value();O=Math.max(0,O);break;case 2:n=a;break;default:throw new{name:"NotImplementedError",message:"unsupported scorev"+g}}var R=Math.pow(1.52163,x.od)*Math.pow(O,24)*2.83;R*=Math.min(1.15,Math.pow(n/1e3,.3));if(p&l.hd)R*=1.02;if(p&l.fl)R*=1.02;this.acc=R;var z=1.12;if(p&l.nf)z*=.9;if(p&l.so)z*=.95;this.total=Math.pow(Math.pow(I,1.1)+Math.pow(N,1.1)+Math.pow(R,1.1),1/1.1)*z;return this};G.prototype.toString=function(){return this.total.toFixed(2)+" pp ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed, "+this.acc.toFixed(2)+" acc)"};G.prototype._base=function(t){return Math.pow(5*Math.max(1,t/.0675)-4,3)/1e5};function Y(t){var i;if(t.map){i=t.map.mode}else{i=t.mode||o.std}switch(i){case o.std:return(new G).calc(t)}throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}osu.timing=s;osu.objtypes=e;osu.circle=r;osu.slider=n;osu.hitobject=a;osu.modes=o;osu.beatmap=h;osu.parser=c;osu.modbits=l;osu.std_beatmap_stats=M;osu.std_diff_hitobject=j;osu.std_diff=H;osu.diff=W;osu.std_accuracy=U;osu.std_ppv2=G;osu.ppv2=Y})();