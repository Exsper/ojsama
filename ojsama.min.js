var osu={};if(typeof exports!=="undefined"){osu=exports}(function(){osu.VERSION_MAJOR=1;osu.VERSION_MINOR=0;osu.VERSION_PATCH=9;var t={warn:Function.prototype};if(typeof exports!=="undefined"){t=console}var i=function(t,i){var s=new Array(t.length);for(var e=0;e<s.length;++e){s[e]=t[e].toFixed(i)}return s};function s(t){this.time=t.time||0;this.ms_per_beat=t.ms_per_beat;if(this.ms_per_beat===undefined){this.ms_per_beat=600}this.change=t.change;if(this.change===undefined){this.change=true}}s.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"ms_per_beat: "+this.ms_per_beat.toFixed(2)+" }"};var e={circle:1<<0,slider:1<<1,spinner:1<<3};function r(t){this.pos=t.pos||[0,0]}r.prototype.toString=function(){return"pos: ["+i(this.pos,2)+"]"};function n(t){this.pos=t.pos||[0,0];this.distance=t.distance||0;this.repetitions=t.repetitions||1}n.prototype.toString=function(){return"pos: "+i(this.pos,2)+", "+"distance: "+this.distance.toFixed(2)+", "+"repetitions: "+this.repetitions};function a(t){this.time=t.time||0;this.type=t.type||0;this.data=t.data||null}a.prototype.typestr=function(){var t="";if(this.type&e.circle)t+="circle | ";if(this.type&e.slider)t+="slider | ";if(this.type&e.spinner)t+="spinner | ";return t.substring(0,Math.max(0,t.length-3))};a.prototype.toString=function(){return"{ time: "+this.time.toFixed(2)+", "+"type: "+this.typestr()+(this.data?", "+this.data.toString():"")+" }"};var o={std:0};function h(){this.reset()}h.prototype.reset=function(){this.format_version=1;this.mode=o.std;this.title=this.title_unicode="";this.artist=this.artist_unicode="";this.creator="";this.version="";this.ar=null;this.cs=this.od=this.hp=5;this.sv=this.tick_rate=1;this.ncircles=this.nsliders=this.nspinners=0;if(!this.objects){this.objects=[]}else{this.objects.length=0}if(!this.timing_points){this.timing_points=[]}else{this.timing_points.length=0}return this};h.prototype.max_combo=function(){var t=this.ncircles+this.nspinners;var i=-1;var s=Number.NEGATIVE_INFINITY;var r=0;for(var n=0;n<this.objects.length;++n){var a=this.objects[n];if(!(a.type&e.slider)){continue}while(a.time>=s){++i;if(this.timing_points.length>i+1){s=this.timing_points[i+1].time}else{s=Number.POSITIVE_INFINITY}var o=this.timing_points[i];var h=1;if(!o.change&&o.ms_per_beat<0){h=-100/o.ms_per_beat}if(this.format_version<8){r=this.sv*100}else{r=this.sv*100*h}}var p=a.data;var c=p.distance*p.repetitions/r;var l=Math.ceil((c-.1)/p.repetitions*this.tick_rate);--l;l*=p.repetitions;l+=p.repetitions+1;t+=Math.max(0,l)}return t};h.prototype.toString=function(){var t=this.artist+" - "+this.title+" [";if(this.title_unicode||this.artist_unicode){t+="("+this.artist_unicode+" - "+this.title_unicode+")"}t+=this.version+"] mapped by "+this.creator+"\n"+"\n"+"AR"+parseFloat(this.ar.toFixed(2))+" "+"OD"+parseFloat(this.od.toFixed(2))+" "+"CS"+parseFloat(this.cs.toFixed(2))+" "+"HP"+parseFloat(this.hp.toFixed(2))+"\n"+this.ncircles+" circles, "+this.nsliders+" sliders, "+this.nspinners+" spinners"+"\n"+this.max_combo()+" max combo"+"\n";return t};function p(){this.map=new h;this.reset()}p.prototype.reset=function(){this.map.reset();this.nline=0;this.curline="";this.lastpos="";this.section="";return this};p.prototype.feed_line=function(t){this.curline=this.lastpos=t;++this.nline;if(t.startsWith(" ")||t.startsWith("_")){return this}t=this.curline=t.trim();if(t.length<=0){return this}if(t.startsWith("//")){return this}if(t.startsWith("[")){if(this.section=="Difficulty"&&this.map.ar==null){this.map.ar=this.map.od}this.section=t.substring(1,t.length-1);return this}if(!t){return this}switch(this.section){case"Metadata":this._metadata();break;case"General":this._general();break;case"Difficulty":this._difficulty();break;case"TimingPoints":this._timing_points();break;case"HitObjects":this._objects();break;default:var i=t.indexOf("file format v");if(i<0){break}this.map.format_version=parseInt(t.substring(i+13));break}return this};p.prototype.feed=function(t){var i=i=t.split("\n");for(var s=0;s<i.length;++s){this.feed_line(i[s])}return this};p.prototype.toString=function(){return"at line "+this.nline+"\n"+this.curline+"\n"+"-> "+this.lastpos+" <-"};p.prototype._setpos=function(t){this.lastpos=t.trim();return this.lastpos};p.prototype._warn=function(){t.warn.apply(null,Array.prototype.slice.call(arguments));t.warn(this.toString())};p.prototype._property=function(){var t=this.curline.split(":",2);t[0]=this._setpos(t[0]);t[1]=this._setpos(t[1]);return t};p.prototype._metadata=function(){var t=this._property();switch(t[0]){case"Title":this.map.title=t[1];break;case"TitleUnicode":this.map.title_unicode=t[1];break;case"Artist":this.map.artist=t[1];break;case"ArtistUnicode":this.map.artist_unicode=t[1];break;case"Creator":this.map.creator=t[1];break;case"Version":this.map.version=t[1];break}};p.prototype._general=function(){var t=this._property();if(t[0]!=="Mode"){return}this.map.mode=parseInt(this._setpos(t[1]))};p.prototype._difficulty=function(){var t=this._property();switch(t[0]){case"CircleSize":this.map.cs=parseFloat(this._setpos(t[1]));break;case"OverallDifficulty":this.map.od=parseFloat(this._setpos(t[1]));break;case"ApproachRate":this.map.ar=parseFloat(this._setpos(t[1]));break;case"HPDrainRate":this.map.hp=parseFloat(this._setpos(t[1]));break;case"SliderMultiplier":this.map.sv=parseFloat(this._setpos(t[1]));break;case"SliderTickRate":this.map.tick_rate=parseFloat(this._setpos(t[1]));break}};p.prototype._timing_points=function(){var t=this.curline.split(",");if(t.length>8){this._warn("timing point with trailing values")}var i=new s({time:parseFloat(this._setpos(t[0])),ms_per_beat:parseFloat(this._setpos(t[1]))});if(t.length>=7){i.change=t[6].trim()!=="0"}this.map.timing_points.push(i)};p.prototype._objects=function(){var t=this.curline.split(",");if(t.length>11){this._warn("object with trailing values")}var i=new a({time:parseFloat(this._setpos(t[2])),type:parseInt(this._setpos(t[3]))});if((i.type&e.circle)!=0){++this.map.ncircles;i.data=new r({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))]})}else if((i.type&osu.objtypes.spinner)!=0){++this.map.nspinners}else if((i.type&osu.objtypes.slider)!=0){++this.map.nsliders;i.data=new n({pos:[parseFloat(this._setpos(t[0])),parseFloat(this._setpos(t[1]))],repetitions:parseInt(this._setpos(t[6])),distance:parseFloat(this._setpos(t[7]))})}this.map.objects.push(i)};var c={nomod:0,nf:1<<0,ez:1<<1,td:1<<2,hd:1<<3,hr:1<<4,dt:1<<6,ht:1<<8,nc:1<<9,fl:1<<10,so:1<<12};c.from_string=function(t){var i=0;t=t.toLowerCase();while(t!=""){var s=1;for(var e in c){if(e.length!=2){continue}if(!c.hasOwnProperty(e)){continue}if(t.startsWith(e)){i|=c[e];s=2;break}}t=t.slice(s)}return i};c.string=function(t){var i="";for(var s in c){if(s.length!=2){continue}if(!c.hasOwnProperty(s)){continue}if(t&c[s]){i+=s.toUpperCase()}}if(i.indexOf("DT")>=0&&i.indexOf("NC")>=0){i=i.replace("DT","")}return i};c.speed_changing=c.dt|c.ht|c.nc;c.map_changing=c.hr|c.ez|c.speed_changing;var l=79.5;var u=19.5;var m=1800;var d=1200;var f=450;var _=(l-u)/10;var v=(m-d)/5;var b=(d-f)/5;function g(t,i,s){var e=t;e*=s;var r=e<5?m-v*e:d-b*(e-5);r=Math.min(m,Math.max(f,r));r/=i;e=r>d?(m-r)/v:5+(d-r)/b;return e}function y(t,i,s){var e=t;e*=s;var r=l-Math.ceil(_*e);r=Math.min(l,Math.max(u,r));r/=i;e=(l-r)/_;return e}function w(t){this.ar=t.ar;this.od=t.od;this.hp=t.hp;this.cs=t.cs;this.speed_mul=1;this._mods_cache={}}w.prototype.with_mods=function(t){if(this._mods_cache[t]){return this._mods_cache[t]}var i=this._mods_cache[t]=new w(this);if(!(t&c.map_changing)){return i}if(t&(c.dt|c.nc))i.speed_mul=1.5;if(t&c.ht)i.speed_mul*=.75;var s=1;if(t&c.hr)s=1.4;if(t&c.ez)s*=.5;if(i.ar){i.ar=g(i.ar,i.speed_mul,s)}if(i.od){i.od=y(i.od,i.speed_mul,s)}if(i.cs){if(t&c.hr)i.cs*=1.3;if(t&c.ez)i.cs*=.5;i.cs=Math.min(10,i.cs)}if(i.hp){i.hp*=s;i.hp=Math.min(10,i.hp)}return i};function M(t){this.obj=t;this.reset()}M.prototype.reset=function(){this.strains=[0,0];this.normpos=[0,0];this.is_single=false;return this};M.prototype.toString=function(){return"{ strains: ["+i(this.strains,2)+"], normpos: ["+i(this.normpos,2)+"], is_single: "+this.is_single+" }"};function j(t,i){return[t[0]-i[0],t[1]-i[1]]}function x(t,i){return[t[0]*i[0],t[1]*i[1]]}function F(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}var k=0;var I=1;var S=90;var T=110;var E=125;var N=[.3,.15];var O=[1400,26.25];var A=.9;var R=400;var z=30;var C=.0675;var D=[512,384];var P=x(D,[.5,.5]);var q=.5;function V(){this.objects=[];this.reset();this.map=null;this.mods=c.nomod;this.singletap_threshold=125}V.prototype.reset=function(){this.total=0;this.aim=0;this.speed=0;this.nsingles=0;this.nsingles_threshold=0};V.prototype.calc=function(t){var i=this.map=t.map||this.map;if(!i){throw new TypeError("no map given")}var s=this.mods=t.mods||this.mods;var r=this.singletap_threshold=t.singletap_threshold||r;var n=new w({cs:i.cs}).with_mods(s);var a=n.speed_mul;this._init_objects(this.objects,i,n.cs);this.speed=this._calc_individual(k,this.objects,a);this.aim=this._calc_individual(I,this.objects,a);this.speed=Math.sqrt(this.speed)*C;this.aim=Math.sqrt(this.aim)*C;if(s&c.td){this.aim=Math.pow(this.aim,.8)}this.total=this.aim+this.speed+Math.abs(this.speed-this.aim)*q;this.nsingles=0;this.nsingles_threshold=0;for(var o=1;o<this.objects.length;++o){var h=this.objects[o].obj;var p=this.objects[o-1].obj;if(this.objects[o].is_single){++this.nsingles}if(!(h.type&(e.circle|e.slider))){continue}var l=(h.time-p.time)/a;if(l>=r){++this.nsingles_threshold}}return this};V.prototype.toString=function(){return this.total.toFixed(2)+" stars ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed)"};V.prototype._spacing_weight=function(t,i){switch(t){case I:return Math.pow(i,.99);case k:if(i>E){return 2.5}else if(i>T){return 1.6+.9*(i-T)/(E-T)}else if(i>S){return 1.2+.4*(i-S)/(T-S)}else if(i>S/2){return.95+.25*(i-S/2)/(S/2)}return.95}throw{name:"NotImplementedError",message:"this difficulty type does not exist"}};V.prototype._calc_strain=function(t,i,s,r){var n=i.obj;var a=s.obj;var o=0;var h=(n.time-a.time)/r;var p=Math.pow(N[t],h/1e3);if((n.type&(e.slider|e.circle))!=0){var c=F(j(i.normpos,s.normpos));if(t==k){i.is_single=c>E}o=this._spacing_weight(t,c);o*=O[t]}o/=Math.max(h,50);i.strains[t]=s.strains[t]*p+o};V.prototype._calc_individual=function(t,i,s){var e=[];var r=R*s;var n=r;var a=0;var o;for(o=0;o<i.length;++o){if(o>0){this._calc_strain(t,i[o],i[o-1],s)}while(i[o].obj.time>n){e.push(a);if(o>0){var h=Math.pow(N[t],(n-i[o-1].obj.time)/1e3);a=i[o-1].strains[t]*h}else{a=0}n+=r}a=Math.max(a,i[o].strains[t])}var p=1;var c=0;e.sort(function(t,i){return i-t});for(o=0;o<e.length;++o){c+=e[o]*p;p*=A}return c};V.prototype._normalizer_vector=function(t){var i=D[0]/16*(1-.7*(t-5)/5);var s=52/i;if(i<z){s*=1+Math.min(z-i,5)/50}return[s,s]};V.prototype._init_objects=function(i,s,r){if(i.length!=s.objects.length){i.length=s.objects.length}var n=this._normalizer_vector(r);var a=x(P,n);for(var o=0;o<i.length;++o){if(!i[o]){i[o]=new M(s.objects[o])}else{i[o].reset()}var h=i[o].obj;if(h.type&e.spinner){i[o].normpos=a.slice();continue}var p;if(h.type&(e.slider|e.circle)){p=h.data.pos}else{t.warn("unknown object type ",h.type.toString(16));p=[0,0]}i[o].normpos=x(p,n)}};function W(){this.calculators=[];this.map=null}W.prototype.calc=function(t){var i=null;var s=this.map=t.map||this.map;if(!s){throw new TypeError("no map given")}if(!this.calculators[s.mode]){switch(s.mode){case o.std:i=new V;break;default:throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}this.calculators[s.mode]=i}else{i=this.calculators[s.mode]}return i.calc(t)};function H(t){this.nmiss=t.nmiss||0;if(t.n300===undefined){this.n300=-1}else{this.n300=t.n300}this.n100=t.n100||0;this.n50=t.n50||0;if(t.percent){var i=t.nobjects;if(i===undefined){throw new TypeError("nobjects is required when specifying percent")}this.nmiss=Math.min(i,this.nmiss);var s=i-this.nmiss;var e=new H({n300:s,n100:0,n50:0,nmiss:this.nmiss}).value()*100;var r=t.percent;r=Math.max(0,Math.min(e,r));this.n100=Math.round(-3*((r*.01-1)*i+this.nmiss)*.5);if(this.n100>s){this.n100=0;this.n50=Math.round(-6*((r*.01-1)*i+this.nmiss)*.5);this.n50=Math.min(s,this.n50)}this.n300=i-this.n100-this.n50-this.nmiss}}H.prototype.value=function(t){var i=this.n300;if(i<0){if(!t){throw new TypeError("either n300 or nobjects must be specified")}i=t-this.n100-this.n50-this.nmiss}else{t=i+this.n100+this.n50+this.nmiss}var s=(i*300+this.n100*100+this.n50*50)/(t*300);return Math.max(0,Math.min(s,1))};H.prototype.toString=function(){return(this.value()*100).toFixed(2)+"% "+this.n100+"x100 "+this.n50+"x50 "+this.nmiss+"xmiss"};function U(){this.aim=0;this.speed=0;this.acc=0;this.computed_accuracy=null}U.prototype.calc=function(t){var i=t.stars;var s=t.map;var e,r,n,a,o,h;var p;var l,u;if(i){s=i.map}if(s){e=s.max_combo();r=s.nsliders;n=s.ncircles;a=s.objects.length;o=s.ar;h=s.od;if(!i){i=(new V).calc(t)}}else{e=t.max_combo;if(!e||e<0){throw new TypeError("max_combo must be > 0")}r=t.nsliders;n=t.ncircles;a=t.nobjects;if(!r||!n||!a){throw new TypeError("nsliders, ncircles, nobjects are required")}if(a<r+n){throw new TypeError("nobjects must be >= nsliders + ncircles")}o=t.base_ar;if(o===undefined)o=5;h=t.base_od;if(h===undefined)h=5}if(i){p=i.mods;l=i.aim;u=i.speed}else{p=t.mods||c.nomod;l=t.aim_stars;u=t.speed_stars}if(l===undefined||u===undefined){throw new TypeError("aim and speed stars required")}var m=t.nmiss||0;var d=t.n50||0;var f=t.n100||0;var _=t.n300;if(_===undefined)_=a-f-d-m;var v=t.combo;if(v===undefined)v=e-m;var b=t.score_version||1;var g=a/2e3;var y=.95+.4*Math.min(1,g);if(a>2e3){y+=Math.log10(g)*.5}var M=Math.pow(.97,m);var j=Math.pow(v,.8)/Math.pow(e,.8);var x=new w({ar:o,od:h}).with_mods(p);this.computed_accuracy=new H({percent:t.acc_percent,nobjects:a,n300:_,n100:f,n50:d,nmiss:m});_=this.computed_accuracy.n300;f=this.computed_accuracy.n100;d=this.computed_accuracy.n50;var F=this.computed_accuracy.value();var k=1;if(x.ar>10.33){k+=.45*(x.ar-10.33)}else if(x.ar<8){var I=.01*(8-x.ar);if(p&c.hd){I*=2}k+=I}var S=this._base(l);S*=y;S*=M;S*=j;S*=k;if(p&c.hd)S*=1.18;if(p&c.fl)S*=1.45*y;var T=.5+F/2;var E=.98+x.od*x.od/2500;S*=T;S*=E;this.aim=S;var N=this._base(u);N*=y;N*=M;N*=j;N*=T;N*=E;this.speed=N;var O=F;switch(b){case 1:var A=a-r-n;O=new H({n300:Math.max(0,_-r-A),n100:f,n50:d,nmiss:m}).value();O=Math.max(0,O);break;case 2:n=a;break;default:throw new{name:"NotImplementedError",message:"unsupported scorev"+b}}var R=Math.pow(1.52163,x.od)*Math.pow(O,24)*2.83;R*=Math.min(1.15,Math.pow(n/1e3,.3));if(p&c.hd)R*=1.02;if(p&c.fl)R*=1.02;this.acc=R;var z=1.12;if(p&c.nf)z*=.9;if(p&c.so)z*=.95;this.total=Math.pow(Math.pow(S,1.1)+Math.pow(N,1.1)+Math.pow(R,1.1),1/1.1)*z;return this};U.prototype.toString=function(){return this.total.toFixed(2)+" pp ("+this.aim.toFixed(2)+" aim, "+this.speed.toFixed(2)+" speed, "+this.acc.toFixed(2)+" acc)"};U.prototype._base=function(t){return Math.pow(5*Math.max(1,t/.0675)-4,3)/1e5};function G(t){var i;if(t.map){i=t.map.mode}else{i=t.mode||o.std}switch(i){case o.std:return(new U).calc(t)}throw{name:"NotImplementedError",message:"this gamemode is not yet supported"}}osu.timing=s;osu.objtypes=e;osu.circle=r;osu.slider=n;osu.hitobject=a;osu.modes=o;osu.beatmap=h;osu.parser=p;osu.modbits=c;osu.std_beatmap_stats=w;osu.std_diff_hitobject=M;osu.std_diff=V;osu.diff=W;osu.std_accuracy=H;osu.std_ppv2=U;osu.ppv2=G})();